<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-firestore.js"></script>
    <script>
        // Deine Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyC61-c9zrpCTZnERdS8P5BKbV8ghr88BoQ",
            authDomain: "forum-465da.firebaseapp.com",
            projectId: "forum-465da",
            storageBucket: "forum-465da.appspot.com",
            messagingSenderId: "331107918743",
            appId: "1:331107918743:web:5680151d1b0a2eb241dad2"
        };
        // Initialisiere Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', () => {
            auth.onAuthStateChanged(user => {
                if (user) {
                    document.getElementById('user-info').innerText = `Angemeldet als: ${user.email}`;
                    document.getElementById('post-form').style.display = 'block';
                    loadPosts();
                } else {
                    document.getElementById('user-info').innerText = 'Nicht angemeldet';
                    document.getElementById('post-form').style.display = 'none';
                }
            });
        });

        function postMessage() {
            const message = document.getElementById('message').value;
            const user = auth.currentUser;
            if (user) {
                db.collection('posts').add({
                    message: message,
                    user: user.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    document.getElementById('message').value = '';
                    loadPosts();
                }).catch(error => {
                    alert('Fehler beim Posten: ' + error.message);
                });
            } else {
                alert('Bitte anmelden, um Beiträge zu erstellen.');
            }
        }

        function loadPosts() {
            db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                const postsContainer = document.getElementById('posts');
                postsContainer.innerHTML = '';
                snapshot.forEach(doc => {
                    const post = doc.data();
                    postsContainer.innerHTML += `<div>
                        <p>${post.message}</p>
                        <small>Von: ${post.user}</small>
                    </div>`;
                });
            });
        }

        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html'; // Weiterleitung zur Anmeldung nach Abmeldung
            });
        }
    </script>
</head>
<body>
    <h1>Forum</h1>
    <div id="user-info">Nicht angemeldet</div>
    <button onclick="logout()">Abmelden</button>
    <div id="post-form" style="display: none;">
        <textarea id="message" placeholder="Deine Nachricht..."></textarea>
        <button onclick="postMessage()">Posten</button>
    </div>
    <div id="posts">
        <!-- Beiträge werden hier geladen -->
    </div>
    <a href="login.html">Zurück zur Anmeldung</a>
</body>
</html>
